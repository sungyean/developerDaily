<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>신청서 보기</title>
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <script type="text/javascript" src="../assets/js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="../assets/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../assets/js/custom.js"></script>
    <!-- 공통 js -->
    <script type="text/javascript" src="../../assets/js/comm.js"></script>
    <!-- Data format 시작 -->
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
</head>
<body>
    <div class="certificate-apply user1 bg-gray" id="wrap">
        <!-- header -->
        <header class="user1">
            <div class="title-box">
                <button class="btn-back" onclick="location.href='step1.html'">
                    <img src="../assets/images/btn-back.png" alt="back">
                </button>
                 <h1>신청서 보기</h1>
            </div>
        </header>
        <!-- //header -->
        <!-- bill -->
        <div class="container bill user1 pd-yes"> 
            <div class="bill-header">
                <p class="tit">신청서 내역</p>
            </div>
            <div class="bill-subheader">
                <ul>
                    <li>
                        <span class="t1">신청일자</span>
                        <span class="t2" id="reqstDt"></span>
                    </li>
                    <li>
                        <span class="t1">발급일자</span>
                        <span class="t2" id="issuDt"></span>
                    </li>
                </ul>
            </div>
            <div class="bill-con">
                <div class="item item1">
                    <p class="tit">기본정보</p>
                    <ul>
                        <li>
                            <span class="t1">운전자명</span>
                            <span class="t2" id="drverNm"></span>
                        </li>
                        <li>
                            <span class="t1">차량번호</span>
                            <span class="t2" id="carNo"></span>
                        </li>
                        <li>
                            <span class="t1">차량유형</span>
                            <span class="t2" id="carCl"></span>
                        </li>
                        <li>
                            <span class="t1">차종명</span>
                            <span class="t2" id="carTy"></span>
                        </li>
                        <li>
                            <span class="t1">최대적재량</span>
                            <span class="t2" id="mxmmLdadngQy"></span>
                        </li>
                    </ul>
                </div>
                <div class="item item2">
                    <p class="tit">추가정보</p>
                    <ul>
                        <li>
                            <span class="t1">출발지</span>
                            <span class="t2" id="strtpnt"></span>
                        </li>
                        <li>
                            <span class="t1">도착지</span>
                            <span class="t2" id="dstn"></span>
                        </li>
                        <li>
                            <span class="t1">방문목적</span>
                            <span class="t2" id="visitPurps"></span>
                        </li>
                    </ul>
                </div>
            </div>           
            <div class="bill-footer three">
                <button class="btn border-green btn-delete">삭제</button>
                <button class="btn border-green btn-modify" onclick="aplicationUpdate();">수정</button>
                <button class="btn bg-green btn-ok2" onclick="mylist();">확인</button>
            </div>
        </div>
        <!-- //bill -->
    </div>
    <div class="popup-wrap delete sm">
        <div class="popup-box sm">
            <div class="popup-header sm">
                <!-- <p>확인</p> -->
                <a href="#" class="btn-popup-close"><img src="../assets/images/btn-popup-close.png" alt="팝업닫기"></a>
            </div>
            <div class="popup-contents sm">
                <p class="txt">정말 삭제하시겠습니까?</p>
            </div>
            <div class="popup-footer sm">
                <button class="btn bg-gray btn-cancel" id="aplicationCancel">취소</button>
                <button class="btn bg-green btn-delete" onclick="aplicationDelete();">삭제</button>
            </div>
        </div>
    </div>
</body>
</html>

<script type="text/javascript">
    let seq = getParameter("seq");
    
    $(document).ready(function(){
        $.ajax({
            url: global.apiUrl+"/elctrnDsnfCerfins/"+seq,
			type: "GET",
			cache: false,
			dataType: "json",
            success: function(data){
                $("#reqstDt").html(moment(data.reqstDt).format('YYYY-MM-DD HH:mm:ss'))
                if(data.issuDt ==null || data.issuDt == ""){
                    $("#issuDt").html('-')
                }else{
                    $("#issuDt").html(moment(data.issuDt).format('YYYY-MM-DD HH:mm:ss'))
                }
                $("#drverNm").html(data.drverNm);
                $("#carNo").html(data.carNo);
                $("#carCl").html(carClareaTranslation(data.carCl));
                $("#carTy").html(data.carTy);
                $("#mxmmLdadngQy").html(data.mxmmLdadngQy+"톤");
                $("#strtpnt").html(data.strtpnt);
                $("#dstn").html(data.dstn);
                $("#visitPurps").html(data.visitPurps);
                
            }
        })
    });
    /* 신청 삭제 */
    function aplicationDelete(){
        let deleteData = {
			"status" : "DELETE"
        }
        $.ajax({
				type: 'PUT',
				url: global.apiUrl+"/elctrnDsnfCerfins/"+seq+"/update",
				async: false,
				data: JSON.stringify(deleteData),
				contentType: "application/json",
				dataType: 'json',
				success: function (res) {
					console.log("res",res)	
				}, 
				complete: function (res) {
					window.location.href="mylist.html"
				}, 
				error: function(err) {
					alert("실패");
				}
			});
    }
    /* 수정 클릭시 수정페이지로 이동 */
    function aplicationUpdate(){
        window.location.href="certificate-apply-modify.html?seq="+seq
    }
    /* 취소버튼 클릭시 모달 close */
    $('#aplicationCancel').on('click',function(e){
        e.preventDefault();
        $(this).parent().parent().parent('.popup-wrap').hide();
    });
    /* 확인 클릭시 마이리스트로 이동 */
    function mylist(){
        window.location.href="mylist.html"
    }
</script>