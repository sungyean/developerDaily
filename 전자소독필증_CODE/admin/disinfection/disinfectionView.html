<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>전자소독필증 상세보기</title>
	<link rel="stylesheet" href="../assets/css/common.css">
	<link rel="stylesheet" href="../assets/css/fonts.css">
	<link rel="stylesheet" href="../assets/css/jquery-ui.css">
	<link rel="stylesheet" href="../assets/css/jquery-ui-1.11.0.css">
	<link rel="stylesheet" href="../assets/css/style.css">
	<script type="text/javascript" src="../assets/js/jquery-3.4.1.min.js"></script>
	<script type="text/javascript" src="../assets/js/jquery-ui.min.js"></script>
	<script type="text/javascript" src="../assets/js/jquery.mCustomScrollbar.min.js"></script>
	<script type="text/javascript" src="../assets/js/custom.js"></script>
	<script type="text/javascript" src="../../assets/js/comm.js"></script>
	<!-- Data format 시작 -->
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
	<!-- Data format 끝-->
</head>
<body>
	<div class="header">
	
		<!-- TOP SECTION -->
		<div id="headers"></div>
		<!-- //TOP SECTION -->
		<!-- GNB SECTION -->
		<div id="gnb"></div>
		<!-- //GNB SECTION -->    
		<!-- contents -->
		<div class="contents clearfix" id="contents">
			<div class="lnb-wrap">
				<h2 class="lnb-tit"><span>전자소독필증 관리</span></h2>
				<ul class="lnb-menu">
					<li class="on">
						<a href="disinfectionList.html">전자소독필증 발급 현황</a>
						<ul>
							<li><a href="disinfectionAdd.html">전자소독필증 등록</a></li>
						</ul>
					</li>
				</ul>
			</div>
			<div class="contents-inn">
				<h3 class="page-tit"><span>전자소독필증 발급현황 상세보기</span></h3>
						   
				<div class="tb-wrap">
					<h4 class="tb-tit"><span class="icon-bullet"><img src="../assets/images/bullet1.png" alt="테이블 제목"></span>기본정보</h4>
					<table class="tb-view">                        
						<tbody>
							<tr>
								<th>회원 ID</th>
								<td id="mberId"></td>
								<th>운전자 명</th>
								<td id="drverNm"></td>
							</tr>
							<tr>
								<th>차량 번호</th>
								<td id="carNo"></td>
								<th>차종 명</th>
								<td id="carTy"></td>
							</tr>
							<tr>
								<th>차량 유형</th>
								<td id="carCl"></td>
								<th>최대 적재량</th>
								<td id="mxmmLdadngQy"></td>
							</tr>
						</tbody>
					</table>
				</div> 
				<div class="tb-wrap">
					<h4 class="tb-tit"><span class="icon-bullet"><img src="../assets/images/bullet1.png" alt="테이블 제목"></span>추가정보</h4>
					<table class="tb-view">                        
						<tbody>
							<tr>
								<th>출발지</th>
								<td id="strtpnt"></td>
								<th>목적지</th>
								<td id="dstn"></td>
							</tr>
							<tr>
								<th>방문 목적</th>
								<td id="visitPurps"></td>
								<th>소독필증 발급일</th>
								<td id="reqstDt"></td>
							</tr>
						</tbody>
					</table>
				</div> 
				<div class="tb-wrap">
					<h4 class="tb-tit"><span class="icon-bullet"><img src="../assets/images/bullet1.png" alt="테이블 제목"></span>GS1코드 발급현황</h4>
					<table class="tb-view">                        
						<tbody>
							<tr>
								<th>GS1코드</th>
								<td id="gs1Code"></td>
								<th id="GS1QRCodeTh">QR코드</th>
								<td id="GS1QRCode">
									<img id="GS1CodeImg" alt="download">
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="tb-wrap" id="confirmDiv">
					<h4 class="tb-tit"><span class="icon-bullet"><img src="../assets/images/bullet1.png" alt="테이블 제목"></span>확인자</h4>
					<table class="tb-view" id="confirmTable">   
						<thead>
							<th>이름</th>
							<th>아이디</th>
							<th>연락처</th>
							<th>가입일</th>
							<th>마지막 접속일</th>
						</thead>                     
						<tbody>
							<tr>
								<td id="name"></td>
								<td id="accountId"></td>
								<td id="telno"></td>
								<td id="createdAt"></td>
								<td id="lastLoginDt"></td>
							</tr>
						</tbody>
					</table>
				</div> 
				<div class="tb-wrap">
					<h4 class="tb-tit"><span class="icon-bullet"><img src="../assets/images/bullet1.png" alt="테이블 제목"></span>발급승인 / 발급거절 정보</h4>
					<table class="tb-view">                        
						<tbody>
							<tr>
								<th>발급 승인 이력</th>
								<td id="issuDt"></td>
								<th>발급 거절 이력</th>
								<td id="issuRejectDt" class="c-red"></td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="btn-tbView-box">
					<button class="btn-delete" type="button" onclick="disinfectionDelete();"><span class="icon-delete"><img src="../assets/images/icon-delete.png" alt="삭제"></span>삭제</button>
					<button class="btn-save" type="button" id="updateButton" dis onclick="disinfectionUpdate();"><span class="icon-save"><img src="../assets/images/icon-save.png" alt="수정"></span>수정</button>
					<button class="btn-list" type="button" onclick="menuListBack();"><span class="icon-list"><img src="../assets/images/icon-list.png" alt="목록"></span>목록</button>
				</div>               
			</div>
		</div>
		<!-- //contents -->
	</div>
</body>
</html>

<script type="text/javascript">
	$("#headers").load("../common/headers.html");
	$("#gnb").load("../common/gnb.html");
	let id = getParameter("id");
	$(document).ready(function(){
		$.ajax({
			url: global.apiUrl+"/elctrnDsnfCerfins/"+id,
			type: "GET",
			cache: false,
			dataType: "json",
			success: function(data){      
				console.log("data",data)
				if(data.status != "REQST"){
					$("#updateButton").attr("disabled",true)
					$("#updateButton").css("background-color","#bcbec0")
				}
				$('#mberId').html(data.mberId);
				$('#drverNm').html(data.drverNm);
				$('#carNo').html(data.carNo);
				$('#carTy').html(data.carTy);
				//차량분류 
				//공통영역에서 번역해 가지고 오기.
				$('#carCl').html(carClareaTranslation(data.carCl));
				$('#mxmmLdadngQy').html(data.mxmmLdadngQy);
				$('#strtpnt').html(data.strtpnt);
				$('#dstn').html(data.dstn);
				$('#visitPurps').html(data.visitPurps);
				$('#reqstDt').html(moment(data.reqstDt).format('YYYY-MM-DD'));
				//날짜 데이터 포멧
				let issuDtFomat = "";
				let issuRejectDtFomat = "";
				//발급승인이력
				if(data.issuDt ==null || data.issuDt == ""){
					issuDtFomat = "-"
				}else{
					issuDtFomat = moment(data.issuDt).format('YYYY-MM-DD');
				}
				$('#issuDt').html(issuDtFomat);
				//발급거절이력
				if(data.issuRejectDt ==null || data.issuRejectDt == ""){
					issuRejectDtFomat = "-"
				}else{
					issuRejectDtFomat = moment(data.issuRejectDt).format('YYYY-MM-DD');
				}
				$('#issuRejectDt').html(issuRejectDtFomat);

				//GS1코드 발급 
				console.log("asd",data.gs1Code)
				if(data.gs1Code == null || data.gs1Code == ""){
					$("#gs1Code").html("GS1코드가 발급되지 않았습니다.")	
					$("#GS1QRCode").hide();
					$("#GS1QRCodeTh").hide();
				}else{
					$("#gs1Code").html(data.gs1Code)
					$("#GS1CodeImg").attr("src",data.gs1PathS);
				}

				if(data.cnfrmrNm == null || data.cnfrmrNm == ""){
					$('#confirmTable').empty();
					$('#confirmDiv').append("<text style='font-size: 12px;'>방문확인 이력이 존재하지 않아 확인자가 존재하지 않습니다.</text>");
				}else{
					//확인자 호출 ajax (현재 등록할때 하드코딩으로 확인자 id값 임의로 넣어주고 있음.)
					$.ajax({
						url: global.apiUrl+"/elctrnDsnfCerfins/"+data.id+"/cnfrmr/",
						type: "GET",
						cache: false,
						dataType: "json",
						success: function(data){  
							console.log("elctrnDsnfCerfins",data)
							
							$('#posiDept').html(data.posiDept);
							$('#position').html(data.position);
							$('#name').html(data.beaconUserNm);
							$('#accountId').html(data.beaconUserId);
							$('#telno').html(data.beaconUserMbtlnum);
							$('#isUsable').html(data.isUsable);
							$('#createdAt').html(moment(data.createdAt).format('YYYY-MM-DD'));
							$('#lastLoginDt').html(moment(data.lastLoginDt).format('YYYY-MM-DD'));
						},
						error: function (request, status, error){  
							var msg = "ERROR<br><br>"
							msg += request.status + "<br>" + request.responseText + "<br>" + error;
							console.log(msg);                    
						}
					})
				}	
			},   
			error: function (request, status, error){  
				var msg = "ERROR<br><br>"
				msg += request.status + "<br>" + request.responseText + "<br>" + error;
				console.log(msg);                    
			}
		});
	}); 
	//목록으로 이동
	function menuListBack(){
		window.location.href="disinfectionList.html";
	}
	//수정 화면으로 이동
	function disinfectionUpdate(){
		window.location.href="disinfectionUpdate.html?id="+id;
	}
	/* 삭제버튼 */
	function disinfectionDelete(){
		var f = confirm("삭제하시겠습니까?");
		let deleteData = {
			"status" : "DELETE"
		}
		if(f){
			$.ajax({
				type: 'PUT',
				url: global.apiUrl+"/elctrnDsnfCerfins/"+id+"/update",
				async: false,
				data: JSON.stringify(deleteData),
				contentType: "application/json",
				dataType: 'json',
				success: function (res) {
					console.log("res",res)	
				}, 
				complete: function (res) {
					window.location.href="./disinfectionList.html"
				},
				error: function(err) {
					alert("실패");
				}
			});
			return false;
		} else {
			return false;
		}

	}
</script>