<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>거점소독시설 관리자 사이트</title>
	<link rel="stylesheet" href="../assets/css/common.css">
	<link rel="stylesheet" href="../assets/css/fonts.css">
	<link rel="stylesheet" href="../assets/css/jquery-ui.css">
	<link rel="stylesheet" href="../assets/css/jquery-ui-1.11.0.css">
	<link rel="stylesheet" href="../assets/css/style.css">
	<script src="../assets/js/jquery-3.4.1.min.js"></script>
	<script src="../assets/js/jquery-ui.min.js"></script>
	<script src="../assets/js/jquery.mCustomScrollbar.min.js"></script>
	<script src="../assets/js/custom.js"></script>
	<script type="text/javascript" src="../../assets/js/comm.js"></script>
	<!-- Data format 시작 -->
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
	<!-- Data format 끝-->
	<!-- smart popup -->
	<link rel="stylesheet" href="../assets/css/jquery.smartPop.css">
	<script type="text/javascript" src="../assets/js/jquery.smartPop.js"></script>
	<script>
		let id;
		let accountTy;
		let accountData;
		$(document).ready(function(){
			$("#headers").load("../common/headers.html");
			$("#gnb").load("../common/gnb.html");

			id = getParameter("accountId");
			
			$.ajax({
				url: global.apiUrl+"/accountDetails/search/findByAccountId?accountId="+id,
				type: "GET",
				cache: false,
				dataType: "json",
				success: function(data){      
					console.log("data",data)
					accountData = data;
					$('#accountTy').html(accountTyTranslation(data.accountTy));
					$('#status').html(accountStatusTranslation(data.status));
					$('#accountId').html(data.accountId);
					$('#nm').html(data.name);
					$('#createdAt').html(moment(data.createdAt).format('YYYY-MM-DD'));
					$('#mobile').html(data.mobile);
					$('#email').html(data.email);
					if(data.sex =="F"){
						$('#sexdstn').html("여성");
					}else{
						$('#sexdstn').html("남성");
					}

					if(data.accountTy== "POSITN_DSNF_FCLTY_MNGR"){
						$("#disInFection").show();
						$.ajax({
							url: global.apiUrl+"/cmDsnfFclties/search/findCmDsnfFcltyOfChrgPbsvnt?keyword="+id,
							type: "GET",
							cache: false,
							dataType: "json",
							success: function(data2){
								console.log(data2)
								$('#fclty_nm').html(data2.nm)
								$('#fclty_area').html(areaTranslation(data2.area))
								$('#fclty_rnAdres1').html(data2.rnAdres1)
								$('#fclty_adres2').html(data2.adres2)
								$('#fclty_status').html(accountStatusTranslation(data2.status))
								$('#position').html(data.position)
								$('#clsf').html(data.clsf)
								$('#workAreaNm').html(data.workAreaNm)
							},   
							error: function (request, status, error){  
								var msg = "ERROR<br><br>"
								msg += request.status + "<br>" + request.responseText + "<br>" + error;
								console.log(msg);
							}
						})
					}
				},   
				error: function (request, status, error){  
					var msg = "ERROR<br><br>"
					msg += request.status + "<br>" + request.responseText + "<br>" + error;
					console.log(msg);                    
				}
			});

		})

		//목록으로 이동
		function menuListBack(){
			window.location.href="systemList.html";
		}
		function searchAccountPop() {
			var width = 800;
			var height = 500;
			var url = './systemFctSearch.html';
			$.smartPop.open({
				width: width,
				height: height,
			isHeightFix : true,
				url: url,
				isScroll : 'yes'
			});
		}
		//수정 화면으로 이동
		function systemUpdate(){
			window.location.href="systemUpdate.html?id="+id;
		}
		/* 삭제버튼 */
		function systemDelete(){
			var f = confirm("삭제하시겠습니까?");
			let deleteData = {
				"accountId": id,
				"accountTy": accountTy,
				"status" : "DELETE"
			}
			if(f){
				$.ajax({
					type: 'PUT',
					url: global.apiUrl+"/members/update",
					async: false,
					data: JSON.stringify(deleteData),
					contentType: "application/json",
					dataType: 'json',
					success: function (res) {
						console.log("res",res)	
					}, 
					complete: function (res) {
						window.location.href="./systemList.html"
					},
					error: function(err) {
						alert("실패");
					}
				});
				return false;
			} else {
				return false;
			}
		}
		//거점소독시설 변경
		function FctChange(){
			searchAccountPop();
		}
		function setFclty(data) {
			console.log("setFcltyData",data);
			console.log("accountData",accountData);
			let formData = {};
			if(accountData.sex == "M"){
				accountData.sex = "MALE"
			}else{
				accountData.sex = "FEMALE"
			}
			formData.accountTy = accountData.accountTy
			formData.name = accountData.name
			formData.accountId = accountData.accountId
			formData.email = accountData.email
			formData.passwd = accountData.pass
			formData.sexdstn = accountData.sex
			formData.moblphon = accountData.mobile
			/* 거점소독시설 관리자일 경우 */
			formData.position =accountData.position
			formData.clsf = accountData.clsf
			formData.workAreaNm = accountData.workAreaNm
			formData.cmDsnfFclty = {
				rnAdres1 : data.rnAdres1,
				lmnAdres1 : data.lmnAdres1,
				adres2 : data.adres2,
				area : data.area,
				nm : data.nm,
				updusrId : data.registerId,
				status :data.status,
				zip : data.zip,
				id : data.id
			};
			console.log("formData",formData)
			if(confirm("거점소독시설을 변경 하시겠습니까?")){
				$.ajax({
					type: "PUT",
					url: global.apiUrl+"/members/update",
					async: false,
					contentType: "application/json",
					data: JSON.stringify(formData),
					dataType: 'json',
					success: function (res) {
						alert("수정을 완료 하였습니다.");
						window.location.href="./systemList.html";
						//window.location.href="./systemView.html?accountId="+accountData.accountId
					}, 
					error: function(err) {
						alert("실패");
					}
				});
				return false;
			} else {
				return false;
			}
		}

	</script>
</head>
<body>
	<div class="header">
	
		<!-- TOP SECTION -->
		<div id="headers"></div>
		<!-- //TOP SECTION -->
		<!-- GNB SECTION -->
		<div id="gnb"></div>
		<!-- //GNB SECTION -->
		<!-- contents -->
		<div class="contents clearfix" id="contents">
			<div class="lnb-wrap">
				<h2 class="lnb-tit"><span>관리자 관리</span></h2>
				<ul class="lnb-menu">
					<li class="on">
						<a href="systemList.html">관리자 현황</a>
						<ul>
							<li><a href="systemAdd.html">관리자 등록</a></li>
						</ul>
					</li>            
				</ul>
			</div>
			<div class="contents-inn">
				<h3 class="page-tit"><span>관리자 상세보기</span></h3>
				<div class="tb-wrap Add">                    
					<table class="tb-list">
						<tbody>
							<tr>
								<th><span class="mark-essential">*</span>관리자 유형</th>
								<td id="accountTy"></td>
								<th><span class="mark-essential">*</span>이름</th>
								<td id="nm"></td>
							</tr> 
							<tr>
								<th><span class="mark-essential">*</span>아이디</th>
								<td id="accountId"></td>
								<th><span class="mark-essential">*</span>연락처</th>
								<td id="mobile"></td>
							</tr> 
							<tr>
								<th><span class="mark-essential">*</span>이메일</th>
								<td id="email"></td>
								<th><span class="mark-essential">*</span>등록일</th>
								<td id="createdAt"></td>
							</tr>
							<tr>
								<th><span class="mark-essential">*</span>계정 상태</th>
								<td id="status"></td>
								<th><span class="mark-essential">*</span>성별</th>
								<td id="sexdstn"></td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="tb-wrap Add" id="disInFection" style="display:none;">
					<h4 class="tb-tit"><span class="icon-bullet"><img src="../assets/images/bullet1.png" alt="테이블 제목"></span>사용자 거점소독시설 정보</h4>
					<div class="btn-add-wrap">
						<button class="btn-add" onclick="FctChange();"><span class="icon-add"><img src="../assets/images/icon-add.png" alt="등록하기"></span>거점소독 시설 변경</button>
					</div>
					<table>                        
						<tbody>
							<tr>
								<th><span class="mark-essential">*</span>시설 명</th>
								<td id="fclty_nm"></td>
								<th><span class="mark-essential">*</span>시설 지역</th>
								<td id="fclty_area"></td>
								<th><span class="mark-essential">*</span>거점소독시설 주소</th>
								<td id="fclty_rnAdres1"></td>                      
								<th><span class="mark-essential">*</span>운영상태</th>
								<td id="fclty_status"></td>    
							</tr>
							<tr>
								<th><span class="mark-essential">*</span>소속</th>
								<td id="position"></td>
								<th><span class="mark-essential">*</span>직급</th>
								<td id="clsf"></td>
								<th><span class="mark-essential">*</span>근무지 명</th>
								<td id="workAreaNm" colspan="3"></td>
							</tr>
						</tbody>
					</table>
				</div>   
				<div class="btn-tbView-box">
					<button class="btn-delete" onclick="systemDelete();"><span class="icon-delete"><img src="../assets/images/icon-delete.png" alt="삭제"></span>삭제</button>
					<button class="btn-save" onclick="systemUpdate();"><span class="icon-save"><img src="../assets/images/icon-save.png" alt="수정"></span>수정</button>
					<button class="btn-list" onclick="menuListBack();"><span class="icon-list"><img src="../assets/images/icon-list.png" alt="목록"></span>목록</button>
				</div>              
			</div>            
		</div>
		<!-- //contents -->
	</div>
</body>
</html>
