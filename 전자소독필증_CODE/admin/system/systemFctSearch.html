
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>거점소독시설 관리자 사이트</title>
	<script type="text/javascript" src="../../assets/js/comm.js"></script>
	<link rel="stylesheet" href="../assets/css/common.css">
	<link rel="stylesheet" href="../assets/css/fonts.css">
	<link rel="stylesheet" href="../assets/css/jquery-ui.css">
	<link rel="stylesheet" href="../assets/css/jquery-ui-1.11.0.css">
	<link rel="stylesheet" href="../assets/css/style.css">
	<script type="text/javascript" src="../assets/js/jquery-3.4.1.min.js"></script>
	<script type="text/javascript" src="../assets/js/jquery-ui.min.js"></script>
	<script type="text/javascript" src="../assets/js/jquery.mCustomScrollbar.min.js"></script>
	<script type="text/javascript" src="../assets/js/custom.js"></script>
	<!-- jquery DataTable script 시작 -->
	<link rel="stylesheet" href="../assets/css/tableData.css">
	<script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
	<!-- jquery DataTable script 끝 -->
	<!-- Data format 시작 -->
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
	<!-- Data format 끝-->
</head>
<body>
	<div class="header">
		<!-- contents -->
    	<div class="contents-inn" style="padding-left: 20px;">
      	<a onclick="closeFuntion();"><img style="width:15px; float:right; padding-bottom: 12px;" src="../assets/images/ico-close.png"alt="팝업닫기"></a>
				<div class="search-condition-box clearfix">
					<table class="tb-modal-option">
						<tr>
							<th>거점소독시설명</th>
							<td class="condition-input-box">
								<div class="search-box">
                  					<input type="text" class="condition search" id="fcltyNm">
                  					<button class="btn-td-search" type="button" onclick="searchFunction();" ><span class="icon-search"><img src="../assets/images/ico-search.png" alt="검색"></span>검색</button>
								</div>
              				</td>
						</tr>
					</table>  
        		</div>
       			<div class="tb-wrap">
					<h4 class="tb-tit"><span class="icon-bullet"><img src="../assets/images/bullet1.png" alt="테이블 제목"></span>거점소독시설</h4>
					<table class="tb-list" id="tableList">
						<thead>
							<tr>
								<th>No</th>
								<th>지역</th>
								<th>거점소독시설명</th>
							</tr>
						</thead>
					</table>
				</div>              
			</div>
		</div>
		<!-- //contents -->
	</div>
</body>
</html>
<script type="text/javascript">
	let draw = "";
	let totalPage = "";
	let table = "";
  	$(document).ready(function() {
	  
	});
	let filter = "";
	//tableList function 
	function tableList(){
	let sum = "";
	let url = "";
    url = global.apiUrl+"/cmDsnfFclties/search/findAvailableCmDsnfFclty?keyword="+$('#fcltyNm').val();
    table = $('#tableList').DataTable({
        //옵션
        "searching": false,
        "pagingType" : "full_numbers",
        "info" : true,
        "paging": true,
        "serverSide":true,
        "ordering" : true,
        "order": [[ 0, "desc" ] ],
        //언어설정
        "language": 
        {   //"현재_START_ - _END_ / _TOTAL_개",
            "info": " _TOTAL_개/총개",
            "emptyTable" : "데이터가 존재하지 않습니다.",
            "sLengthMenu": "",
            "paginate": {
                "first": "맨앞",
                "next": "다음",
                "previous": "이전",
                "last": "맨끝"
            }
        },
        "ajax": 
        {
            "type" : "GET",
            "url" : url,
            "data" : function(data){
                let page = "";
                let sort = "";
                page = "&page=" + parseInt(data.start/10);
                sort = "&sort=" + "id,desc"
                if(data.order[0].dir == 'asc'){sort = "&sort=" + "id,asc"}
                if(data.order[0].dir == 'desc') {sort = "&sort=" + "id,desc"}
                draw = data.draw
                let sum = page + sort
                return sum
            },
            //data 명 바꾸기.
            'dataFilter': function(retData) {     
                retData = JSON.parse(retData);  
                console.log("retData",retData)
                if(draw ==1){
                    retData["recordsTotal"] = retData.page.totalElements;
                    totalPage = retData.page.totalElements;
                }
                retData["recordsTotal"] = totalPage;
                retData["recordsFiltered"] =  retData.page.totalElements;
                retData["data"] =retData._embedded.cmDsnfFclties;
                return JSON.stringify(retData);
            },
            columnDefs: [
                { id: 'No', targets: 0 },
            ],
            complete:function(data){
                document.getElementById('tableList_info').innerHTML=data.responseJSON.recordsFiltered+"개/총"+data.responseJSON.recordsTotal+"개"
            }
        },
        "columns": [
            {targets: 0,data: "id"},			//번호
            {targets: 1, data: "area" },		//지역
            {targets: 2, data: "nm", },//거점소독시설명
        ],
        //cell 데이터 변경
        "columnDefs":[
            {
                "render": function (data,type,row){
                    //areaSelect(data) 공통영역에서 지역 한글로 변경함.
                    return areaTranslation(data);
                },
                "targets" : 1
            },
        ],
    });  
    };

	function searchFunction(){
		//DataTable 초기화. 
		$('#tableList').DataTable().destroy();
		//DataTable 호출
		tableList();
  	}
	$('#tableList').on('click', 'tr', function () {
    	var data = table.row( this ).data();
		parent.setFclty(data);
		parent.$.smartPop.close();
  	});
  	//모달창 close
	function closeFuntion(){
		parent.$.smartPop.close();
	}
</script>